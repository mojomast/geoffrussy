version: '3.8'

services:
  geoffrussy:
    build:
      context: .
      dockerfile: Dockerfile
    image: geoffrussy:latest
    container_name: geoffrussy
    volumes:
      - ./:/workspace
      - geoffrussy-data:/home/geoffrey/.geoffrussy
    working_dir: /workspace
    environment:
      - GEOFFRUSSY_CONFIG_PATH=/home/geoffrey/.geoffrussy
    stdin_open: true
    tty: true

  # Development container with hot reload
  geoffrussy-dev:
    image: golang:1.21-alpine
    container_name: geoffrussy-dev
    volumes:
      - ./:/app
      - go-mod-cache:/go/pkg/mod
    working_dir: /app
    command: sh -c "apk add --no-cache git gcc musl-dev sqlite-dev make && tail -f /dev/null"
    environment:
      - CGO_ENABLED=1
    stdin_open: true
    tty: true

volumes:
  geoffrussy-data:
  go-mod-cache:
